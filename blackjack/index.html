<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="../css/style.css">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <!-- JavaScript -->
    <script>
      var numOptimalPlays = localStorage.getItem("numOptimalPlays");
      var numTotalGames = localStorage.getItem("");
      var numDecks = 1;
      var allowSurrender = true;
      var shoe = [];
      var playerHand = [];
      var dealerHand = [];
      var minCardsBeforeShuffle = 11;
      var gameMode = "standardPractice";

      function presetDeck() {
        if (numOptimalPlays == null) {
          numOptimalPlays = 0;
        }
        if (numTotalGames == null) {
          numTotalGames = 0;
        }

        createNewShoe();

        document.getElementById("numOptimalPlays").innerHTML = parseInt(numOptimalPlays);
      }

      function createNewShoe() {
        shoe = [];
        for (let deck = 0; deck < numDecks; deck++) {
          for (let card = 1; card <= 13; card++) {
            shoe.push(card, card, card, card);
          }
        }
        shuffleArray(shoe);
        console.log("New shoe created from " + numDecks + " deck(s): " + shoe);
      }

      function getBestValue(hand) {
        var bestValue = 0;
        var numAces = 0;
        for (const card of hand) {
          if (card == 1) {
            bestValue += 11;
            numAces += 1;
          } else if (card > 10) {
            bestValue += 10;
          } else {
            bestValue += card;
          }
          if (bestValue > 21 && numAces > 0) {
            bestValue -= 10;
            numAces -= 1;
          }
        }
        console.log(bestValue);
        return bestValue;
      }

      function startNewRound() {
        playerHand = [];
        dealerHand = [];
        if (shoe.length <= minCardsBeforeShuffle) {
          console.log("Shoe too small; reshuffling cards.");
          createNewShoe();
        }
        dealHands(gameMode);
        enableCardActionButtons();
        var playerHandValue = getBestValue(playerHand);
        if (playerHandValue == 21) {
          disableCardActionButtons();
        }
      }

      function cardActionHit() {
        playerHand.push(shoe.pop());
        renderHand(playerHand, "playerHand");
        document.getElementById("button1").disabled = false;
        document.getElementById("button3").disabled = false;
        document.getElementById("button5").disabled = false;
        checkGame();
      }

      function cardActionSurrender() {
        disableCardActionButtons();
        endGame();
      }

      function cardActionDouble() {
        cardActionHit();
        disableCardActionButtons();
        endGame();
      }

      function cardActionStand() {
        disableCardActionButtons();
        endGame();
      }

      function cardActionSplit() {
        endGame();
      }

      function checkGame() {
        var playerHandValue = getBestValue(playerHand);
        var dealerHandValue = getBestValue(dealerHand);
        if (playerHandValue == 21 || dealerHandValue > 21) {
          endGame();
        } else if (dealerHandValue == 21 || playerHandValue > 21) {
          endGame();
        }
      }

      function enableCardActionButtons() {
        document.getElementById("button1").disabled = false;
        document.getElementById("button2").disabled = false;
        document.getElementById("button3").disabled = false;
        document.getElementById("button4").disabled = false;
        document.getElementById("button5").disabled = false;
      }

      function disableCardActionButtons() {
        document.getElementById("button1").disabled = true;
        document.getElementById("button2").disabled = true;
        document.getElementById("button3").disabled = true;
        document.getElementById("button4").disabled = true;
        document.getElementById("button5").disabled = true;
      }

      function endGame() {
        disableCardActionButtons();
        renderHand(playerHand, "playerHand");
        renderHand(dealerHand, "dealerHand");
      }

      function dealHands(gameMode) {
        if (gameMode === "standardPractice") {
          playerHand.push(shoe.pop());
          dealerHand.push(shoe.pop());
          playerHand.push(shoe.pop());
          dealerHand.push(shoe.pop());
          renderHand(playerHand, "playerHand");
          renderHand(dealerHand.slice(0, 1), "dealerHand");
        }
      }

      function renderHand(hand, handOwner) {
        var handString = "";
        for (const card of hand) {
          if (card == 1) {
            handString += "A ";
          } else if (card > 10) {
            if (card == 11) {
              handString += "J ";
            } else if (card == 12) {
              handString += "Q ";
            } else if (card == 13) {
              handString += "K ";
            }
          } else {
            handString += card + " ";
          }
          if (hand.length == 1) {
            handString += " X"
          }
        }
        document.getElementById(handOwner).innerHTML = handString;
      }

      const shuffleArray = array => {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          const temp = array[i];
          array[i] = array[j];
          array[j] = temp;
        }
      }

      window.onload = presetDeck;
    </script>

    <link rel="icon" href="../files/gifs/Penguin.gif">
    <title>Blackjack Simulator</title>

  </head>

  <body>
    <div class="container-fluid">
      <div class="row">
        <div class="col">
          <p id="optimalPlays">Number of optimal plays: <a id="numOptimalPlays">0</a></p>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <p id="player">Your hand: <a id="playerHand">empty</a></p>
        </div>
        <div class="col">
          <p id="dealer">Dealer's hand: <a id="dealerHand">empty</a></p>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <button type="button" class="btn btn-primary" id ="button1" onclick="cardActionSurrender()" disabled>Surrender</button>
          <button type="button" class="btn btn-primary" id ="button2" onclick="cardActionHit()" disabled>Hit</button>
          <button type="button" class="btn btn-primary" id ="button3" onclick="cardActionDouble()" disabled>Double</button>
          <button type="button" class="btn btn-primary" id ="button4" onclick="cardActionStand()" disabled>Stand</button>
          <button type="button" class="btn btn-primary" id ="button5" onclick="cardActionSplit()" disabled>Split</button>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <button type="button" class="btn btn-primary" id ="newRoundButton" onclick="startNewRound()">New round</button>
        </div>
      </div>
    </div>
  </body>

</html>
